pval[i] = NA
}
}
fdrVal = p.adjust(pval,method = 'BH')
annotation2$is_coexpressed = ifelse(fdrVal < 0.05, 'Yes','No')
colorList$is_coexpressed = c('#FD8D3CFF','#370335FF')
names(colorList$is_coexpressed) = c('Yes','No')
TF_expression_rxn = colnames(GRN)[GRN[targetTF,] == 1]
annotation2$is_target = ifelse(colnames(rows.cor) %in% TF_expression_rxn, 'Yes','No')
colorList$is_target = c('#FD8D3CFF','#370335FF')
names(colorList$is_target) = c('Yes','No')
dev.off()
pdf(paste('figures/',outName,'_co-expression_coFlux.pdf',sep = ''),width = 24,height = 16)
pheatmap(rows.cor, breaks = seq(-1,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(2000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList,labels_col = labels_col,
annotation_col = annotation2[,c('pathway_major','isPredicted','isCorrelated','is_target','is_coexpressed','TF_coexpression_r')],
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 2, fontsize_col = 4,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE,
fontsize_number = 5)
dev.off()
targetTF = 'YDR034C'
outName = 'lys14'
targetTF_expression = t(RNAallExp[targetTF,3:ncol(RNAallExp)])
hist(cor(targetTF_expression,rxnExpMat))
corV = t(cor(targetTF_expression, rxnExpMat))
annotation2[rownames(corV),'TF_coexpression_r'] = corV[,1]
colorList$TF_coexpression_r = c('#00FF00','#ff0000')
names(colorList$TF_coexpression_r) = c('-1','1')
pval = numeric()
for (i in 1:ncol(rxnExpMat)){
if (!all(is.na(rxnExpMat[,i]))){
tmp  = cor.test(targetTF_expression, rxnExpMat[,i])
pval[i] = tmp$p.value
}else{
pval[i] = NA
}
}
fdrVal = p.adjust(pval,method = 'BH')
annotation2$is_coexpressed = ifelse(fdrVal < 0.05, 'Yes','No')
colorList$is_coexpressed = c('#FD8D3CFF','#370335FF')
names(colorList$is_coexpressed) = c('Yes','No')
TF_expression_rxn = colnames(GRN)[GRN[targetTF,] == 1]
annotation2$is_target = ifelse(colnames(rows.cor) %in% TF_expression_rxn, 'Yes','No')
colorList$is_target = c('#FD8D3CFF','#370335FF')
names(colorList$is_target) = c('Yes','No')
dev.off()
pdf(paste('figures/',outName,'_co-expression_coFlux.pdf',sep = ''),width = 24,height = 16)
pheatmap(rows.cor, breaks = seq(-1,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(2000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList,labels_col = labels_col,
annotation_col = annotation2[,c('pathway_major','isPredicted','isCorrelated','is_target','is_coexpressed','TF_coexpression_r')],
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 2, fontsize_col = 4,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE,
fontsize_number = 5)
dev.off()
allTF
##############search for the TF that is pos corr with purine and - use greedy TF list - known metabolic regulator#######
# search for the TF that is pos corr with puring - use greedy TF list - known metabolic regulator
allTF_ID = allTF$TFid
allTF_ID = intersect(allTF_ID, rownames(RNAallExp))
puringrxns = rownames(annotation)[annotation$pathway_major == 'Purine metabolism']
# intersect the selected TF and assign rownames
# check for correlation
aveCorr = numeric()
for (i in 1:length(allTF_ID)){
targetTF = allTF_ID[i]
targetTF_expression = t(RNAallExp[targetTF,3:ncol(RNAallExp)])
corV = t(cor(targetTF_expression,rxnExpMat[,puringrxns]))
# weight the cor r by the GRN
#corV = corV * exp(GRN[targetTF,rownames(corV)])
aveCorr = c(aveCorr,sum(as.numeric(corV)))
}
names(aveCorr) = allTF_ID
aveCorr = sort(aveCorr,decreasing = T)
aveCorr[1:10]
targetTF = 'YIL131C'
outName = 'FKH1'
targetTF_expression = t(RNAallExp[targetTF,3:ncol(RNAallExp)])
hist(cor(targetTF_expression,rxnExpMat))
corV = t(cor(targetTF_expression, rxnExpMat))
annotation2[rownames(corV),'TF_coexpression_r'] = corV[,1]
colorList$TF_coexpression_r = c('#00FF00','#ff0000')
names(colorList$TF_coexpression_r) = c('-1','1')
pval = numeric()
for (i in 1:ncol(rxnExpMat)){
if (!all(is.na(rxnExpMat[,i]))){
tmp  = cor.test(targetTF_expression, rxnExpMat[,i])
pval[i] = tmp$p.value
}else{
pval[i] = NA
}
}
fdrVal = p.adjust(pval,method = 'BH')
annotation2$is_coexpressed = ifelse(fdrVal < 0.05, 'Yes','No')
colorList$is_coexpressed = c('#FD8D3CFF','#370335FF')
names(colorList$is_coexpressed) = c('Yes','No')
TF_expression_rxn = colnames(GRN)[GRN[targetTF,] == 1]
annotation2$is_target = ifelse(colnames(rows.cor) %in% TF_expression_rxn, 'Yes','No')
colorList$is_target = c('#FD8D3CFF','#370335FF')
names(colorList$is_target) = c('Yes','No')
dev.off()
pdf(paste('figures/',outName,'_co-expression_coFlux.pdf',sep = ''),width = 24,height = 16)
pheatmap(rows.cor, breaks = seq(-1,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(2000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList,labels_col = labels_col,
annotation_col = annotation2[,c("pathway_major",'isPredicted','isCorrelated','is_target','is_coexpressed','TF_coexpression_r')],
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 2, fontsize_col = 4,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE,
fontsize_number = 5)
dev.off()
r_mat = read.csv('output/crossCorrelation_rMat.csv',row.names = 1) # the pearson r of expression (row) -> flux (col)
colnames(r_mat) = rownames(r_mat)
pheatmap(r_mat, breaks = seq(-1,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(2000),
#clustering_distance_rows = 'correlation',
#clustering_distance_cols = 'correlation',
annotation_row = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
annotation_col = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
annotation_colors = colorList,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 5, fontsize_col = 8,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE)
# by p-value
p_mat = read.csv('output/crossCorrelation_pMat.csv',row.names = 1) # the pearson r of expression (row) -> flux (col)
colnames(p_mat) = rownames(p_mat)
p_mat = -log10(p_mat) * sign(r_mat)
pheatmap(p_mat, breaks = seq(-5,5,0.1),color = colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(101),
#clustering_distance_rows = rows.dist,
#clustering_distance_cols = rows.dist,
annotation_row = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
annotation_col = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
annotation_colors = colorList,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 5, fontsize_col = 8,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE)
colnames(r_mat)
View(r_mat)
labels_col2 = paste(colnames(r_mat),annotation[colnames(r_mat),'pathway'])
labels_row2 = paste(rownames(r_mat),annotation[rownames(r_mat),'pathway'])
dev.off()
labels_col2 = paste(colnames(r_mat),annotation[colnames(r_mat),'pathway'])
labels_row2 = paste(rownames(r_mat),annotation[rownames(r_mat),'pathway'])
pdf('figures/cross-flux-expression-correlation.pdf',width = 28,height = 20)
pheatmap(r_mat, breaks = seq(-1,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(2000),
#clustering_distance_rows = 'correlation',
#clustering_distance_cols = 'correlation',
annotation_row = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
annotation_col = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
labels_col = labels_col2, labels_row = labels_row2,
annotation_colors = colorList,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 3, fontsize_col = 7,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE,
fontsize_number = 5)
dev.off()
# by p-value
p_mat = read.csv('output/crossCorrelation_pMat.csv',row.names = 1) # the pearson r of expression (row) -> flux (col)
dev.off()
labels_col2 = paste(colnames(r_mat),annotation[colnames(r_mat),'pathway'])
labels_row2 = paste(rownames(r_mat),annotation[rownames(r_mat),'pathway'])
pdf('figures/cross-flux-expression-correlation.pdf',width = 28,height = 20)
pheatmap(r_mat, breaks = seq(-1,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(2000),
#clustering_distance_rows = 'correlation',
#clustering_distance_cols = 'correlation',
annotation_row = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
annotation_col = annotation2[,c("pathway_major",'isPredicted','isCorrelated'),drop = F],
labels_col = labels_col2, labels_row = labels_row2,
annotation_colors = colorList,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 7, fontsize_col = 7,
#cellwidth = 8, cellheight = 4,
cluster_rows = TRUE,cluster_cols = TRUE,
fontsize_number = 5)
dev.off()
library(pheatmap)
library(RColorBrewer)
mat = read.csv('output/heatmapTbl.csv')
sig = read.csv('output/heatmapTbl_sigLabel.csv')
boundary = read.csv('output/heatmapTbl_boundaries.csv')
heatTbl = mat[,2:ncol(mat)]
colnames(heatTbl) = boundary$Var1[1:(ncol(mat)-1)]
rownames(heatTbl) = mat$Row
sigTbl = ifelse(sig[,2:ncol(mat)]==1, '+','')
#heatTbl = heatTbl / apply(heatTbl, 1,max)
# Pairwise correlation between rows (genes)
# rows.cor <- cor(t(heatTbl), use = "pairwise.complete.obs", method = "pearson")
library(stringr)
annotation = read.csv('manualPathwayAnnotation.csv')
colors = read.csv('figures/simpsons_color.csv',header = F)
#annotationList = table(annotation$pathway_major)
#annotationList = sort(annotationList,decreasing = T)
annotationList = c('Purine metabolism','Phenylalanine, tyrosine and tryptophan biosynthesis','Histidine metabolism','Lysine biosynthesis',
'Arginine biosynthesis','Methionine, folate and sulfur metabolism','Proline biosynthesis','Pyrimidine metabolism',
'central carbon metabolism','Other amino acids', 'transporter [exchange]',
'Fructose, mannose, sucrose, trahelose and glucan metabolism','FA and PL metabolism',
'transporter [inner]','Others')
colorList = colors$V1[2:(1+length(annotationList))]
#names(colorList) = c(names(annotationList)[2:(length(annotationList)-1)],names(annotationList)[1],names(annotationList)[(length(annotationList))])
names(colorList) = annotationList
colorList = list(pathway_major = colorList)
rownames(annotation) = annotation$rxn
dev.off()
pdf('figures/boundary_heatmap.pdf',width = 24,height = 14)
pheatmap(heatTbl, breaks = seq(0,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(1000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 5, fontsize_col = 8,
cellwidth = 12, cellheight = 5,
cluster_rows = TRUE,cluster_cols = FALSE,
display_numbers = sigTbl, number_color = 'Black',fontsize_number = 5)
dev.off()
setwd('./../6.humanTissue_MERGE/input/MSEA_dataset/')
install.packages('Cairo')
install.packages("devtools")
library(devtools)
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("devtools")
library(devtools)
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("pacman")
library(pacman)
pacman::p_load(c("impute", "pcaMethods", "globaltest", "GlobalAncova", "Rgraphviz", "preprocessCore", "genefilter", "SSPA", "sva", "limma", "KEGGgraph", "siggenes","BiocParallel", "MSnbase", "multtest","RBGL","edgeR","fgsea"))
library(pacman)
pacman::p_load(c("impute", "pcaMethods", "globaltest", "GlobalAncova", "Rgraphviz", "preprocessCore", "genefilter", "SSPA", "sva", "limma", "KEGGgraph", "siggenes","BiocParallel", "MSnbase", "multtest","RBGL","edgeR","fgsea"))
library(pacman)
pacman::p_load(c("impute", "pcaMethods", "globaltest", "GlobalAncova", "Rgraphviz", "preprocessCore", "genefilter", "SSPA", "sva", "limma", "KEGGgraph", "siggenes","BiocParallel", "MSnbase", "multtest","RBGL","edgeR","fgsea"))
metanr_packages <- function(){
metr_pkgs <- c("impute", "pcaMethods", "globaltest", "GlobalAncova", "Rgraphviz", "preprocessCore", "genefilter", "SSPA", "sva", "limma", "KEGGgraph", "siggenes","BiocParallel", "MSnbase", "multtest","RBGL","edgeR","fgsea","devtools","crmn")
list_installed <- installed.packages()
new_pkgs <- subset(metr_pkgs, !(metr_pkgs %in% list_installed[, "Package"]))
if(length(new_pkgs)!=0){if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(new_pkgs)
print(c(new_pkgs, " packages added..."))
}
if((length(new_pkgs)<1)){
print("No new packages added...")
}
}
metanr_packages()
metanr_packages()
install.packages("ncdf4")
install.packages("ncdf4")
metanr_packages()
metanr_packages()
I
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("ctc")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("ctc")
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("gdata")
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("glasso")
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("huge")
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
install.packages("ppcor")
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
#install.packages("devtools")
library(devtools)
metanr_packages()
require(devtools)
#install.packages("devtools")
require(devtools)
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
# Step 2: Install MetaboAnalystR without documentation
devtools::install_github("xia-lab/MetaboAnalystR", build = FALSE, build_vignettes = FALSE)
library(MetaboAnalystR)
tmp.vec <- c("Acetoacetic acid", "Beta-Alanine", "Creatine", "Dimethylglycine")
mSet<-InitDataObjects("conc", "msetora", FALSE)
mSet<-Setup.MapData(mSet, tmp.vec);
mSet<-CrossReferencing(mSet, "name");
ls
mSet<-SetCurrentMsetLib(mSet, "smpdb_pathway", 2)
?SetCurrentMsetLib
mSet<-SetCurrentMsetLib(NA, "location", 0)
?InitDataObjects
mSet<-SetCurrentMsetLib(mSetObj=NA, "location", 0)
mSet<-SetCurrentMsetLib(mSetObj, "location", 0)
mSet, "
mSet<-SetCurrentMsetLib(mSet, "location", 0)
read.table('location.qs')
a  = read.table('location.qs')
View(mSet)
?CalculateGlobalTestScore
open CalculateGlobalTestScore
view(CalculateGlobalTestScore)
edit(CalculateGlobalTestScore)
UseMethod(CalculateGlobalTestScore)
body(CalculateGlobalTestScore)
?.prepare.globaltest.score
?prepare.globaltest.score
library(qs)
df2 <- qread("location.qs")
View(df2)
df1 <- load(file = )
df1 <- load(file = 'MetaboAnalyst-4.93_location.rda')
load(file = 'MetaboAnalyst-4.93_location.rda')
View(current.msetlib)
View(df2)
df1 = current.msetlib
View(df1)
any(df1$id != df2$id)
any(df1$id == df2$id)
any(df1$name != df2$id)
any(df1$name != df2$name)
any(df1$member != df2$member)
load("~/Documents/GitHub/MERGE2/3_FPA/6.humanTissue_MERGE/input/MSEA_dataset/MetaboAnalyst-4.93_location.rda")
a = load("~/Documents/GitHub/MERGE2/3_FPA/6.humanTissue_MERGE/input/MSEA_dataset/MetaboAnalyst-4.93_location.rda")
a
load("~/Documents/GitHub/MERGE2/3_FPA/6.humanTissue_MERGE/input/MSEA_dataset/MetaboAnalyst-4.93_location.rda")
rm(current.msetlib)
load("~/Documents/GitHub/MERGE2/3_FPA/6.humanTissue_MERGE/input/MSEA_dataset/MetaboAnalyst-4.93_location.rda")
df2 <- qread("location.qs")
View(current.msetlib)
library(pheatmap)
library(RColorBrewer)
######## heatmap for target Out titration#####
mat = read.csv('output/heatmapTbl_targetOut.csv')
sig = read.csv('output/heatmapTbl_sigLabel_targetOut.csv')
boundary = read.csv('output/heatmapTbl_boundaries_targetOut.csv')
heatTbl = mat[,2:ncol(mat)]
colnames(heatTbl) = boundary$Var1[1:(ncol(mat)-1)]
rownames(heatTbl) = mat$Row
sigTbl = ifelse(sig[,2:ncol(mat)]==1, '+','')
#heatTbl = heatTbl / apply(heatTbl, 1,max)
# Pairwise correlation between rows (genes)
# rows.cor <- cor(t(heatTbl), use = "pairwise.complete.obs", method = "pearson")
library(stringr)
annotation = read.csv('manualPathwayAnnotation.csv')
colors = read.csv('figures/simpsons_color.csv',header = F)
#annotationList = table(annotation$pathway_major)
#annotationList = sort(annotationList,decreasing = T)
annotationList = c('Purine metabolism','Phenylalanine, tyrosine and tryptophan biosynthesis','Histidine metabolism','Lysine biosynthesis',
'Arginine biosynthesis','Methionine, folate and sulfur metabolism','Proline biosynthesis','Pyrimidine metabolism',
'central carbon metabolism','Other amino acids', 'transporter [exchange]',
'Fructose, mannose, sucrose, trahelose and glucan metabolism','FA and PL metabolism',
'transporter [inner]','Others')
colorList = colors$V1[2:(1+length(annotationList))]
#names(colorList) = c(names(annotationList)[2:(length(annotationList)-1)],names(annotationList)[1],names(annotationList)[(length(annotationList))])
names(colorList) = annotationList
colorList = list(pathway_major = colorList)
rownames(annotation) = annotation$rxn
dev.off()
pdf('figures/boundary_heatmap_targetOut.pdf',width = 24,height = 14)
labels_row0 = paste(rownames(heatTbl),annotation[rownames(heatTbl),'pathway'])
pheatmap(heatTbl, breaks = seq(0,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(1000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList, labels_row = labels_row0,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 5, fontsize_col = 8,
cellwidth = 12, cellheight = 5,
cluster_rows = TRUE,cluster_cols = FALSE,
display_numbers = sigTbl, number_color = 'Black',fontsize_number = 5)
dev.off()
################plot4: realDist and rel corr -- target Out##########
mat = read.csv('output/relCorr_heatmapTbl_realDist_targetOut.csv')
sig = read.csv('output/heatmapTbl_sigLabel_realDist_targetOut.csv')
boundary = read.csv('output/heatmapTbl_boundaries_realDist_targetOut.csv')
heatTbl = mat[,2:ncol(mat)]
colnames(heatTbl) = boundary$Var1[1:(ncol(mat)-1)]
rownames(heatTbl) = mat$Row
sigTbl = ifelse(sig[,2:ncol(mat)]==1, '+','')
dev.off()
pdf('figures/boundary_heatmap_realDist.pdf',width = 24,height = 14)
dev.off()
################plot3: realDist and rel corr##########
mat = read.csv('output/relCorr_heatmapTbl_realDist.csv')
sig = read.csv('output/heatmapTbl_sigLabel_realDist.csv')
boundary = read.csv('output/heatmapTbl_boundaries_realDist.csv')
heatTbl = mat[,2:ncol(mat)]
colnames(heatTbl) = boundary$Var1[1:(ncol(mat)-1)]
rownames(heatTbl) = mat$Row
sigTbl = ifelse(sig[,2:ncol(mat)]==1, '+','')
dev.off()
pdf('figures/boundary_heatmap_realDist.pdf',width = 24,height = 14)
# we do row-wise left nearest impute: the prediction should be same to the left-most one if no new reaction can be seen as the distance boundary increase
for (i in 1:nrow(heatTbl)){
for (j in 1:(ncol(heatTbl))){
if (is.na(heatTbl[i,j])){
p1 = heatTbl[i,1:j-1]
p1 = p1[!is.na(p1)]
# p2 = heatTbl[i,(j+1):ncol(heatTbl)]
# p2 = p2[!is.na(p2)]
s1 = sigTbl[i,1:j-1]
s1 = s1[!is.na(p1)]
heatTbl[i,j] = p1[length(p1)]#mean(c(p1[length(p1)],p2[1]))
sigTbl[i,j] = s1[length(s1)]#mean(c(p1[length(p1)],p2[1]))
}
}
}
#heatTbl[is.na(heatTbl)] = 0
# reorder according to annotation table
library(xlsx)
annTbl = read.xlsx('./output/predictionMechanism_annotation.xlsx','Sheet1',header = T)
rownames(sigTbl) = rownames(heatTbl)
heatTbl = heatTbl[annTbl$rxn,]
sigTbl = sigTbl[annTbl$rxn,]
labels_row0 = paste(rownames(heatTbl),annotation[rownames(heatTbl),'pathway'])
pheatmap(heatTbl[,1:38], breaks = seq(0,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(1000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList, labels_row = labels_row0,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 5, fontsize_col = 8,
cellwidth = 12, cellheight = 5,
cluster_rows = FALSE,cluster_cols = FALSE
,display_numbers = sigTbl[,1:38], number_color = 'Black',fontsize_number = 5
)
dev.off()
################plot4: realDist and rel corr -- target Out##########
mat = read.csv('output/relCorr_heatmapTbl_realDist_targetOut.csv')
sig = read.csv('output/heatmapTbl_sigLabel_realDist_targetOut.csv')
boundary = read.csv('output/heatmapTbl_boundaries_realDist_targetOut.csv')
heatTbl = mat[,2:ncol(mat)]
colnames(heatTbl) = boundary$Var1[1:(ncol(mat)-1)]
rownames(heatTbl) = mat$Row
sigTbl = ifelse(sig[,2:ncol(mat)]==1, '+','')
dev.off()
pdf('figures/boundary_heatmap_realDist_targetOut.pdf',width = 24,height = 14)
# we do row-wise left nearest impute: the prediction should be same to the left-most one if no new reaction can be seen as the distance boundary increase
for (i in 1:nrow(heatTbl)){
for (j in 1:(ncol(heatTbl))){
if (is.na(heatTbl[i,j])){
p1 = heatTbl[i,1:j-1]
p1 = p1[!is.na(p1)]
# p2 = heatTbl[i,(j+1):ncol(heatTbl)]
# p2 = p2[!is.na(p2)]
s1 = sigTbl[i,1:j-1]
s1 = s1[!is.na(p1)]
heatTbl[i,j] = p1[length(p1)]#mean(c(p1[length(p1)],p2[1]))
sigTbl[i,j] = s1[length(s1)]#mean(c(p1[length(p1)],p2[1]))
}
}
}
#heatTbl[is.na(heatTbl)] = 0
# reorder according to annotation table
library(xlsx)
annTbl = read.xlsx('./output/predictionMechanism_annotation.xlsx','Sheet1',header = T)
rownames(sigTbl) = rownames(heatTbl)
heatTbl = heatTbl[annTbl$rxn,]
sigTbl = sigTbl[annTbl$rxn,]
labels_row0 = paste(rownames(heatTbl),annotation[rownames(heatTbl),'pathway'])
pheatmap(heatTbl[,1:38], breaks = seq(0,1,0.001),color = colorRampPalette(rev(brewer.pal(n = 7, name =
"RdYlBu")))(1000),
# clustering_distance_rows = as.dist(1 - rows.cor),
annotation_row = annotation[,c("pathway_major"),drop = F],
annotation_colors = colorList, labels_row = labels_row0,
gaps_col = 1,
# legend_breaks = seq2,legend_labels = legend_labels,
border_color = 'black',
fontsize = 8,fontsize_row = 5, fontsize_col = 8,
cellwidth = 12, cellheight = 5,
cluster_rows = FALSE,cluster_cols = FALSE
,display_numbers = sigTbl[,1:38], number_color = 'Black',fontsize_number = 5
)
dev.off()
